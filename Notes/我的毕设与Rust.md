这段文字是我碎碎念，搞了点流水账记录我的毕设和Rust的学习经历。

2023年11月，我开始了我的毕设。

11月底时，我拿到了offer结束秋招，当时想着offer方向不错，要么继续找相关方向的什么项目抄一下，比如Games104的小引擎，并且我实习时候也捣鼓了一下，感觉抄一个小的，似乎还行?.....但是我回想到C++中各种各样的痛苦调试，调库的困难，让我直接望而却步了。

为了找工作，功利的刷了CMU15445这类优秀的网课，想起刷lab给我的巨大提升，并且考虑到我拿到offer后有很长的空闲时间，想着要不找点有挑战性的玩意，不做前后端这种crud毕设。首先Bustub这种已经有好几万行的项目，改成毕设问题不大，但是Bustub毕竟根据教学内容有所取舍，比如没有WAL，页面组织的TableHeap我看的眼花缭乱，里面的设计让我大为震撼，没办法掰扯一通变成自己的毕设。

之后再看了xv6-rust，BlogOS，发现Rust里面满足了我对C++中缺失的功能的想象，首先配置文件一键调包，让我这种码力不足，走捷径调库cv代码的简直是天堂，而且没有C++的一堆魔法(学了才发现魔法也不少😅)，于是我开始考虑流放C++，弄个Big news用Rust整个操作系统，然鹅，blogos跟了几章发现，Rust写操作系统充满了magic，又是汇编，又是各种编译target，同时一上手我就直面unsafe与Rust语言的黑暗面，于是我开始考虑改换门庭，换个方向。

与此同时，我在github上看到了ToyDB,RisingLight这种小玩意，发现Rust写数据库有很多demo供我cv爽，并且之前我写过15445简直是buff拉满。本着没事干学学的想法，我决定用Rust写个数据库当毕设。

说的简单，做的就不太简单了,最开始我看的bustubx，一个佬在rewrite bustub in rust，并且工作量不少，我跟着写后发现，用rust改写原来c++的逻辑非常痛苦，可变不可变与我在c++中的裸奔编程思想剧烈碰撞，我意识到直接按原来逻辑得和rust中的各种法律条文进行抵触......

比如，我使用shared_ptr随地大小便，引用乱传的好日子到头了。刚开始，我看Arc，发现针不戳，又是原子，又是引用计数，可不就是shared_ptr嘛，然后发现不可变🤡,然后又套RefCell，弄出运行时panic，又改成Mutex，改成持有引用又被生命周期狠狠踩头🤡🤡。

我决定得找点rusty的玩意魔改。很幸运，toydb这个项目有大佬开始讲解了，跟着佬在知乎的文章，开始读懂toydb，并学习toydb的rusty写法，感觉自己功利见长。于是，抄写了一遍toydb，并砍了许多功能，先做了个原型。

然鹅，toydb的bitcask存储引擎看起来过于简单了，与我在任务书中夸下的海口想去甚远。并且，作者自己写的sqlparser也让我难以扩展。

非常凑巧的是，24年2月份左右，迟先生开始大量重构了minilsm，并且看到了KKould的KipSQL，并且同样方便我替换魔改，我就决定放弃toydb，抄写了KipSQL二开作为毕设。

KipSQL的代码设计看起来挺干净，不过KipDB的设计我不太喜欢，虽然码量不算大，但是我还是决定替换成测试量更足，支持功能更适合我的minilsm，并起名叫小猪数据库PiggySQL。

抄完后，我的数据库总算是有点样子了，支持一点简单的查询，还有jdbc，能过糊弄过答辩了。

不得不说，Rust确实有advanced C++的感觉，简单干净的模块管理，cargo包管理，还有报错提示，体验真是编译器按着你的手写代码。